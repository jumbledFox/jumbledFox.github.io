<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="icon" type="image/x-icon" href="images/favicon.png">
    
        <link rel="stylesheet" href="css/style.css">
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.10.4/gsap.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/remarkable/1.7.1/remarkable.min.js"></script>

        <script src="scripts/main-stuff.js"></script>

        <script>

            window.addEventListener('load', 
                function() { 
                let loc = window.location;
                    if(loc.search[1] == "/") { // If we need to redirect
                        let decoded = loc.search.slice(1).split("&").map(function(s) {
                            return s.replace(/~and~/g, "&");
                        }).join((loc.search.includes("&")) ? "?" : "") + loc.hash;

                        console.log(decoded);

                        // Push the new URL to the history stack
                        window.history.pushState(decoded.slice(1), ``, decoded);

                        // Load page
                        loadPage(loc.pathname.slice(1));
                    } else {
                        // Load index
                        loadPage("");
                    }

                }, false);

            const md = new Remarkable({
                html:true
            });

            // Loading pages
            function loadPage(filelocation) {
                if(filelocation == "") {
                    filelocation = "index";
                }
                fileLoc = "pages/" + filelocation + ".md";

                $.ajax({
                    type: 'HEAD',
                    url: 'https://jumbledFox.github.io/pages/' + filelocation + '.md',

                success: function() {
                    $.get(fileLoc, function(data) {
                        $("#main").html(md.render(data));
                    });
                },
                error: function() {
                    $.get("pages/404.md", function(data) {
                        $("#main").html(md.render(data));
                    });
                }
                });
            }
            
            function manageLinks(event) {
                var pagePath = event.path[0].href.replace("https://" + event.path[0].host, "");
                console.log(pagePath[0]);
                if(pagePath[0] == "/" || pagePath.length == 0) {
                    loadPage(pagePath.slice(1));
                    return false;
                }
            } document.onclick = manageLinks;

        </script>
    </head>
    <body>
        <div id="fly-holder"></div>
        <div id="gradient"></div>

        <div id="centerer">
            <div></div>
            <div id="main">

            </div>
            <div></div>
        </div>
    </body>
</html>